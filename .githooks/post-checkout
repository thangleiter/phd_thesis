#!/bin/sh
# Universal post-checkout launcher - save as .githooks/post-checkout
# This script detects the platform and launches the appropriate version

# Get the directory of this script
SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
PYTHON_SCRIPT="$SCRIPT_DIR/post-checkout.py"

# Detect platform and execute accordingly
case "$(uname -s)" in
  CYGWIN*|MINGW*|MSYS*)
    # Windows via Git Bash
    powershell -NoProfile -ExecutionPolicy Bypass -Command "$MAMBA_EXE run -n base python" "$PYTHON_SCRIPT" "$@"
    if [ $? -ne 0 ]; then
      echo "Failed to run post-checkout hook."
    fi
    ;;
  *)
    # Unix-like systems
    if command -v python3 >/dev/null 2>&1; then
      python3 "$PYTHON_SCRIPT" "$@"
    elif command -v python >/dev/null 2>&1; then
      python "$PYTHON_SCRIPT" "$@"
    else
      echo "Python not found. Please ensure Python is installed and in your PATH."
      exit 1
    fi
    ;;
esac
