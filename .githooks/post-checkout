#!/bin/sh
# Universal post-checkout launcher - save as .githooks/post-checkout
# This script detects the platform and launches the appropriate version

is_branch_checkout=$3

# Only run for branch checkouts (not file checkouts)
if [ "$is_branch_checkout" = "1" ]; then
    echo "Switched branches, updating submodules..."
    git submodule update

    # Copy to ~/texmf on windows only (on linux the soft link works
    case "$(uname -s)" in
      *MINGW*|*MSYS*)
        HOMEDIR="$USERPROFILE"
        COMMAND="cp --recursive --update"
      ;; Linux|Darwin)
        HOMEDIR="$HOME"
        COMMAND="ln --symbolic --force --backup"
      ;; *)
      ;;
    esac

    TEXMF_DIR="$HOMEDIR/texmf/tex/latex"
    FONT_DIR="$HOMEDIR/texmf/fonts/truetype/LiberationMono"

    mkdir -p "$TEXMF_DIR"
    mkdir -p "$FONT_DIR"

    $COMMAND ./lib/kaobook "$TEXMF_DIR"
    $COMMAND ./lib/fonts/LiberationMono/*.ttf "$FONT_DIR"
fi

exit $?

